<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Vacation Timer</title>
  <style>
    * {
      cursor: none;
    }

    html, body {
      width: 100%;
      height: 100%;
      margin: 0px;
      padding: 0px;
      background: white;
      overflow: hidden;
    }

    canvas {
      width: 100%;
      height: 200px;
      margin: 0px;
      padding: 0px;
      background: white;
      overflow: hidden;
    }

    iframe {
      width: 100%;
      height: 880px;
      margin: 0px;
      padding: 0px;
      border: 0;
      background: white;
      overflow: hidden;
    }
  </style>
  <meta http-equiv="refresh" content="1200">
</head>
<body>
  <script>



    // settings
    var scrollSpeed = 0.2; // px per ms
    var tileWidth = 800;
    var tileHeight = 200;
    var textMargin = 5;
    var tiles = [];

    tiles.push(new Employee("Andrew Hoyt", "#333f4f", "#ffff00", 19, 11.92, new Date("2016-12-26"), new Date("2017-09-01")));
    tiles.push(new Employee("Andy Knapp", "black", "green", 24, 294.89, new Date("2017-08-21"), new Date("2017-08-21")));
    tiles.push(new Employee("Chris Mikola", "#8E44AD", "white", 24, -13.96, new Date("2016-12-26"), new Date("2017-08-01")));
    tiles.push(new Employee("Derek Lauer", "gray", "blue", 16, -56.1, new Date("2016-12-26"), new Date("2017-09-05")));
    tiles.push(new Employee("Jason Farlow", "black", "green", 19, -60.31, new Date("2016-12-26"), new Date("2017-08-07")));
    tiles.push(new Employee("Jason Hotra", "#016533", "white", 24, 87.75, new Date("2016-12-26"), new Date("2017-08-14")));
    tiles.push(new Employee("John L. Gettel", "black", "#00FFFF", 24, 29.11, new Date("2016-12-26"), new Date("2017-09-01")));
    tiles.push(new Employee("Ken T", "grey", "black", 24, 305.68, new Date("2017-07-21"), new Date("2017-08-01")));
    tiles.push(new Employee("Kevin Chaney", "Turquoise", "black", 17, -63.9, new Date("2016-12-26"), new Date("2017-09-05")));
    tiles.push(new Employee("Michelle", "pink", "gray", 24, 81.2400, new Date("2017-07-07"), new Date("2017-08-01")));
    tiles.push(new Employee("Mike Legg", "red", "white", 24, 239.57, new Date("2017-07-05"), new Date("2017-08-01")));
    tiles.push(new Employee("Ryan Mathewson", "black", nyan, 19, 171.45, new Date("2016-12-26"), new Date("2017-09-01")));
    tiles.push(new Employee("Scott Lawless", "#92278F", "#FFFFFF", 24, 403.0300, new Date("2017-07-28"), new Date("2017-08-01")));
    tiles.push(new Employee("Taylor Osmonson", "black", "orange", 19, 16.79, new Date("2017-07-16"), new Date("2017-08-01")));

    tiles.push(new Employee("Co-ops", "black", "white", 0, 0, new Date("2017-06-23"), new Date("2020-08-04")));

    var sitesToRotate = ["https://www.windy.com/?radar,42.074,-83.480,8,m:eP2adP0",
                         "https://systemssupport.leidos.com/",
                         "https://systemssupport.leidos.com/CalendarPage.aspx",
                         "https://app.powerbi.com/view?r=eyJrIjoiYzEyODFiZTMtOTM0MC00Njk0LTk5MzAtMWM4MzRhM2Q4OTIzIiwidCI6IjZhOTg0M2Y0LTk3ZDgtNDZlMi1iODQzLTJjNWUyNWJiNzE5YiIsImMiOjR9",
                         "https://app.powerbi.com/view?r=eyJrIjoiMmZlNzczMDktYmVlNS00NDBlLWJkYzItY2VkYjkxMjMxMmY4IiwidCI6IjZhOTg0M2Y0LTk3ZDgtNDZlMi1iODQzLTJjNWUyNWJiNzE5YiIsImMiOjR9",
                         "https://app.powerbi.com/view?r=eyJrIjoiMTZjZTA0ZDEtZDZlYS00MGY1LTlkZWQtZWNhYzM5YWVkOWI3IiwidCI6IjZhOTg0M2Y0LTk3ZDgtNDZlMi1iODQzLTJjNWUyNWJiNzE5YiIsImMiOjR9"];

    // working variables
    var leftEdge = 0;
    var lastDrawTime = Date.now();
    var leftMostTileIndex = 0;
    var lastSiteRotation = new Date();
    var siteRotationIndex = 0;


    // canvas setup
    var canvas = document.createElement('canvas');
    canvas.id = "canvas";
    document.body.appendChild(canvas);
    var ctx = canvas.getContext("2d");

    // iFrame setup
    var iframe = document.createElement('iframe');
    document.body.appendChild(iframe);
    iframe.src = sitesToRotate[siteRotationIndex];

    function Draw() {

      var now = new Date();

      canvas.width = window.innerWidth;
      canvas.height = tileHeight;

      if (now - lastSiteRotation > 1000 * 60) {
        siteRotationIndex++;
        if (siteRotationIndex >= sitesToRotate.length)
          siteRotationIndex = 0;
        lastSiteRotation = now;
        iframe.src = sitesToRotate[siteRotationIndex];
      }


      var msSincelastDrawTime = Date.now() - lastDrawTime;
      var delta = scrollSpeed * msSincelastDrawTime;
      leftEdge -= delta;

      while (leftEdge < -tileWidth) {
        leftEdge += tileWidth;
        leftMostTileIndex++;
      }
      leftMostTileIndex = leftMostTileIndex % tiles.length

      tiles.sort(function (a, b) { return b.currentPTOHours() - a.currentPTOHours(); });

      // Draw
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      var x = leftEdge;
      var i = leftMostTileIndex;
      while (x < (canvas.width + tileWidth)) {
        if (i >= tiles.length)
          i = 0;

        var tile = tiles[i];
        ctx.fillStyle = tile.getBackgroundColor();
        ctx.fillRect(x, 0, tileWidth, tileHeight);
        ctx.font = "90px Arial";
        ctx.fillStyle = tile.getForegroundColor();
        ctx.fillText(tile.name, x + textMargin, 80);

        // Expire outdated people (30 days)
        var ptoText = "Expired";
        if (!tile.isExpired()) {
          var yearsSinceStart = ((Date.now() - tile.startdate) / 1000.0 / 60.0 / 60.0 / 24.0 / 365.0);
          var hours = tile.currentPTOHours();
          var minutes = (hours % 1) * 60.0;
          var seconds = (minutes % 1) * 60.0;
          var milliseconds = (seconds % 1) * 1000;
          ptoText = Math.floor(hours) + ":" + ("00" + Math.floor(minutes)).substr(-2, 2) + ":" + ("00" + Math.floor(seconds)).substr(-2, 2) + "." + ("000" + Math.floor(milliseconds)).substr(-3, 3);
        }
        ctx.fillText(ptoText, x + textMargin, 180);


        x += tileWidth;
        i++;
      }

      lastDrawTime = Date.now();
      requestAnimationFrame(Draw);
    }

    requestAnimationFrame(Draw);


    function Employee(name, background, foreground, rate, pto, startdate, lastupdate, hiredate) {
      this.name = name;
      this.background = background;
      this.foreground = foreground;
      this.rate = rate;
      this.pto = pto;
      this.startdate = startdate;
      this.lastupdate = lastupdate;
      this.hiredate = startdate;

      this.isExpired = function() {
        return new Date() > this.lastupdate.addDays(30)
      }

      this.currentPTOHours = function () {
        var yearsSinceStart = ((Date.now() - this.startdate) / 1000.0 / 60.0 / 60.0 / 24.0 / 365.0);
        return this.pto + (yearsSinceStart * this.rate * 8);
      }

      this.getAccrualRates = function (){
        var start = new Date(this.hiredate);
        return [
          {"startdate": new Date(start), "ptoDaysPerYear": 16},
          {"startdate": new Date(start.setFullYear(start.getFullYear() + 2)), "ptoDaysPerYear": 17},
          {"startdate": new Date(start.setFullYear(start.getFullYear() + 2)), "ptoDaysPerYear": 19},
          {"startdate": new Date(start.setFullYear(start.getFullYear() + 5)), "ptoDaysPerYear": 24},
        ];
      }

      this.getBackgroundColor = function () {
        if (typeof background === "function")
          return background();
        else
          return background;
      }

      this.getForegroundColor = function () {
        if (typeof foreground === "function")
          return foreground();
        else
          return foreground;
      }


    }

    function RGB2Color(r, g, b) {
      return '#' + byte2Hex(r) + byte2Hex(g) + byte2Hex(b);
    }

    function byte2Hex(n) {
      var nybHexString = "0123456789ABCDEF";
      return String(nybHexString.substr((n >> 4) & 0x0F, 1)) + nybHexString.substr(n & 0x0F, 1);
    }

    function nyan() {
      var now = new Date();
      var frequency = 0.001;
      red = Math.sin(frequency * now + 0) * 127 + 128;
      green = Math.sin(frequency * now + 2) * 127 + 128;
      blue = Math.sin(frequency * now + 4) * 127 + 128;
      return RGB2Color(red, green, blue);
    }

    Date.prototype.addDays = function (days) {
      var dat = new Date(this.valueOf());
      dat.setDate(dat.getDate() + days);
      return dat;
    }


  </script>
</body>
</html>